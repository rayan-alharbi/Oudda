---

---

<!-- Load CropperJS CSS v1.5.13 -->
<link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css"
/>

<div class="crop-tool">
    <div class="toolbar">
        <label for="img-in" class="file-btn">
            <span class="icon">ğŸ“‚</span> Ø§Ø®ØªØ± ØµÙˆØ±Ø©
        </label>
        <input type="file" id="img-in" accept="image/*" class="hidden-input" />

        <button id="crop-btn" class="btn-primary" disabled>
            <span class="icon">âœ‚ï¸</span> Ù‚Øµ (Crop)
        </button>

        <button id="reset-btn" class="btn-sec" disabled>
            <span class="icon">ğŸ”„</span> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
        </button>
    </div>

    <div class="workspace">
        <div class="editor-container">
            <div class="editor-wrapper">
                <img id="image" src="" alt="Source" />
            </div>
        </div>

        <div class="preview-container">
            <h4>Ø§Ù„Ù†ØªÙŠØ¬Ø© (Result)</h4>
            <div id="res-view" class="res-view"></div>
            <button id="dl-btn" class="btn-action hidden">
                <span class="icon">â¬‡ï¸</span> ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
            </button>
        </div>
    </div>
</div>

<!-- Load CropperJS JS v1.5.13 explicitly to match CSS -->
<script
    is:inline
    src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"
></script>

<script>
    // Define Cropper type for TS check bypass in global scope if needed, or just use window.Cropper
    declare const Cropper: any;

    const inp = document.getElementById("img-in") as HTMLInputElement;
    const image = document.getElementById("image") as HTMLImageElement;
    const resView = document.getElementById("res-view");
    const cropBtn = document.getElementById("crop-btn") as HTMLButtonElement;
    const resetBtn = document.getElementById("reset-btn") as HTMLButtonElement;
    const dlBtn = document.getElementById("dl-btn") as HTMLButtonElement;

    let cropper = null;

    inp.addEventListener("change", () => {
        const file = inp.files[0];
        if (file) {
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }

            const url = URL.createObjectURL(file);
            image.src = url;

            // Clean UI
            resView.innerHTML = "";
            dlBtn.classList.add("hidden");

            // Wait for image to load in DOM
            image.onload = () => {
                // @ts-ignore
                cropper = new Cropper(image, {
                    aspectRatio: NaN,
                    viewMode: 1,
                    autoCropArea: 0.8,
                    responsive: true,
                    background: false, // Cleaner look
                });

                cropBtn.disabled = false;
                resetBtn.disabled = false;
            };
        }
    });

    cropBtn.addEventListener("click", () => {
        if (!cropper) return;

        const canvas = cropper.getCroppedCanvas();
        if (!canvas) return;

        resView.innerHTML = "";
        const img = document.createElement("img");
        img.src = canvas.toDataURL();
        resView.appendChild(img);

        dlBtn.classList.remove("hidden");
        dlBtn.onclick = () => {
            const link = document.createElement("a");
            link.download = "cropped-image.png";
            link.href = canvas.toDataURL("image/png");
            link.click();
        };
    });

    resetBtn.addEventListener("click", () => {
        if (cropper) cropper.reset();
    });
</script>

<style>
    .crop-tool {
        max-width: 1000px;
        margin: 0 auto;
    }

    .toolbar {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .file-btn {
        background: #334155;
        color: white;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: background 0.2s;
    }
    .file-btn:hover {
        background: #475569;
    }

    .hidden-input {
        display: none;
    }

    .btn-primary,
    .btn-sec,
    .btn-action {
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        border: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 1rem;
    }

    .btn-primary {
        background: var(--c-primary);
        color: white;
    }
    .btn-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .btn-sec {
        background: var(--c-surface);
        border: 1px solid var(--c-border);
        color: var(--c-text);
    }
    .btn-sec:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .btn-action {
        background: #16a34a;
        color: white;
        margin-top: 15px;
        width: 100%;
        justify-content: center;
    }

    .workspace {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
    }
    @media (min-width: 900px) {
        .workspace {
            grid-template-columns: 2fr 1fr;
        }
    }

    .editor-container {
        background: #0f172a;
        border-radius: 8px;
        padding: 20px;
        border: 1px solid var(--c-border);
        min-height: 400px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .editor-wrapper {
        max-width: 100%;
        max-height: 600px;
    }

    /* Ensure image doesn't overflow before cropper inits */
    #image {
        max-width: 100%;
        display: block;
    }

    .preview-container {
        background: var(--c-surface);
        padding: 20px;
        border-radius: 8px;
        border: 1px solid var(--c-border);
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .res-view {
        width: 100%;
        min-height: 200px;
        border: 2px dashed var(--c-border);
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--c-background);
        overflow: hidden;
    }

    .res-view img {
        max-width: 100%;
        max-height: 400px;
        object-fit: contain;
    }

    .hidden {
        display: none;
    }
</style>
