---

---

<div class="age-calculator">
    <div class="calendar-toggle">
        <label>
            <input type="radio" name="cal-type" value="g" checked />
            <span>Ù…ÙŠÙ„Ø§Ø¯ÙŠ</span>
        </label>
        <label>
            <input type="radio" name="cal-type" value="h" />
            <span>Ù‡Ø¬Ø±ÙŠ</span>
        </label>
    </div>

    <!-- Gregorian Input -->
    <div id="g-input-section" class="input-section">
        <label for="birthdate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ (Ù…ÙŠÙ„Ø§Ø¯ÙŠ)</label>
        <input type="date" id="birthdate" class="form-input" />
    </div>

    <!-- Hijri Input -->
    <div id="h-input-section" class="input-section hidden">
        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ (Ù‡Ø¬Ø±ÙŠ)</label>
        <div class="h-date-row">
            <input
                type="number"
                id="h-day"
                placeholder="Ø§Ù„ÙŠÙˆÙ…"
                class="form-input"
                min="1"
                max="30"
            />
            <select id="h-month" class="form-select"></select>
            <input
                type="number"
                id="h-year"
                placeholder="Ø§Ù„Ø³Ù†Ø©"
                class="form-input"
                min="1300"
                max="1500"
            />
        </div>
    </div>

    <button id="calc-btn" class="btn-primary">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…Ø±</button>

    <div id="result-container" class="result-container hidden">
        <div class="result-grid">
            <!-- Gregorian Age -->
            <div class="result-card g-aging">
                <h3>Ø§Ù„Ø¹Ù…Ø± Ø¨Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ ðŸ“…</h3>
                <div class="main-age">
                    <span class="value" id="g-years">0</span>
                    <span class="unit">Ø³Ù†Ø©</span>
                </div>
                <div class="small-details">
                    <span id="g-months">0</span> Ø´Ù‡Ø± Ùˆ
                    <span id="g-days">0</span> ÙŠÙˆÙ…
                </div>
            </div>

            <!-- Hijri Age -->
            <div class="result-card h-aging">
                <h3>Ø§Ù„Ø¹Ù…Ø± Ø¨Ø§Ù„Ù‡Ø¬Ø±ÙŠ ðŸŒ™</h3>
                <div class="main-age">
                    <span class="value" id="h-years">0</span>
                    <span class="unit">Ø³Ù†Ø©</span>
                </div>
                <div class="small-details">
                    <span id="h-months">0</span> Ø´Ù‡Ø± Ùˆ
                    <span id="h-days">0</span> ÙŠÙˆÙ…
                </div>
            </div>
        </div>

        <div class="extra-info">
            <p>ÙŠÙˆÙ… Ù…ÙŠÙ„Ø§Ø¯Ùƒ Ø§Ù„Ù‚Ø§Ø¯Ù… Ø¨Ø¹Ø¯: <strong id="next-birthday"></strong></p>
        </div>
    </div>
</div>

<script>
    import { toGregorian, toHijri } from "hijri-converter";

    const gSection = document.getElementById("g-input-section");
    const hSection = document.getElementById("h-input-section");
    const radios = document.querySelectorAll('input[name="cal-type"]');

    const birthInput = document.getElementById("birthdate") as HTMLInputElement;
    const hDay = document.getElementById("h-day") as HTMLInputElement;
    const hMonth = document.getElementById("h-month") as HTMLSelectElement;
    const hYear = document.getElementById("h-year") as HTMLInputElement;

    const calcBtn = document.getElementById("calc-btn");
    const container = document.getElementById("result-container");

    const hijriMonths = [
        "Ù…Ø­Ø±Ù…",
        "ØµÙØ±",
        "Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„",
        "Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ",
        "Ø¬Ù…Ø§Ø¯Ù‰ Ø§Ù„Ø£ÙˆÙ„Ù‰",
        "Ø¬Ù…Ø§Ø¯Ù‰ Ø§Ù„Ø¢Ø®Ø±Ø©",
        "Ø±Ø¬Ø¨",
        "Ø´Ø¹Ø¨Ø§Ù†",
        "Ø±Ù…Ø¶Ø§Ù†",
        "Ø´ÙˆØ§Ù„",
        "Ø°Ùˆ Ø§Ù„Ù‚Ø¹Ø¯Ø©",
        "Ø°Ùˆ Ø§Ù„Ø­Ø¬Ø©",
    ];

    hijriMonths.forEach((m, i) => {
        hMonth.add(new Option(m, (i + 1).toString()));
    });

    radios.forEach((r) => {
        r.addEventListener("change", (e: any) => {
            if (e.target.value === "g") {
                gSection.classList.remove("hidden");
                hSection.classList.add("hidden");
            } else {
                gSection.classList.add("hidden");
                hSection.classList.remove("hidden");
            }
            container.classList.add("hidden");
        });
    });

    birthInput.max = new Date().toISOString().split("T")[0];

    function calculateDiff(
        year: number,
        month: number,
        day: number,
        type: "g" | "h",
    ) {
        const today = new Date();

        let cYear, cMonth, cDay; // Current Date parts

        if (type === "g") {
            cYear = today.getFullYear();
            cMonth = today.getMonth() + 1; // 1-index
            cDay = today.getDate();
        } else {
            const hToday = toHijri(
                today.getFullYear(),
                today.getMonth() + 1,
                today.getDate(),
            );
            cYear = hToday.hy;
            cMonth = hToday.hm;
            cDay = hToday.hd;
        }

        let years = cYear - year;
        let months = cMonth - month;
        let days = cDay - day;

        if (days < 0) {
            months--;
            // Simple approach for days overflow: add 30 for Hijri approximation or get real days for G
            if (type === "g") {
                const prevMonth = new Date(
                    today.getFullYear(),
                    today.getMonth(),
                    0,
                );
                days += prevMonth.getDate();
            } else {
                days += 30; // Approximation for Hijri
            }
        }

        if (months < 0) {
            years--;
            months += 12;
        }

        return { years, months, days };
    }

    function calculateAge() {
        const type = (
            document.querySelector(
                'input[name="cal-type"]:checked',
            ) as HTMLInputElement
        ).value;
        let birthG, birthH;

        if (type === "g") {
            if (!birthInput.value) return;
            const date = new Date(birthInput.value);
            birthG = {
                year: date.getFullYear(),
                month: date.getMonth() + 1,
                day: date.getDate(),
            };
            // Convert G birth to H birth
            const h = toHijri(birthG.year, birthG.month, birthG.day);
            birthH = { year: h.hy, month: h.hm, day: h.hd };
        } else {
            const d = parseInt(hDay.value);
            const m = parseInt(hMonth.value);
            const y = parseInt(hYear.value);
            if (!d || !m || !y) return;

            birthH = { year: y, month: m, day: d };
            // Convert H birth to G birth
            const g = toGregorian(y, m, d);
            birthG = { year: g.gy, month: g.gm, day: g.gd };
        }

        // Calculate Gregorian Age
        const gAge = calculateDiff(birthG.year, birthG.month, birthG.day, "g");
        document.getElementById("g-years").textContent = gAge.years.toString();
        document.getElementById("g-months").textContent =
            gAge.months.toString();
        document.getElementById("g-days").textContent = gAge.days.toString();

        // Calculate Hijri Age
        const hAge = calculateDiff(birthH.year, birthH.month, birthH.day, "h");
        document.getElementById("h-years").textContent = hAge.years.toString();
        document.getElementById("h-months").textContent =
            hAge.months.toString();
        document.getElementById("h-days").textContent = hAge.days.toString();

        // Next Birthday (Gregorian based logic for simplicity)
        const today = new Date();
        const nextBirthday = new Date(
            today.getFullYear(),
            birthG.month - 1,
            birthG.day,
        );
        if (nextBirthday < today) {
            nextBirthday.setFullYear(today.getFullYear() + 1);
        }
        const diffTime = Math.abs(nextBirthday.getTime() - today.getTime());
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        document.getElementById("next-birthday").textContent =
            `${diffDays} ÙŠÙˆÙ…`;

        container.classList.remove("hidden");
    }

    calcBtn.addEventListener("click", calculateAge);
</script>

<style>
    .age-calculator {
        max-width: 600px;
        margin: 0 auto;
    }

    .calendar-toggle {
        display: flex;
        justify-content: center;
        gap: var(--space-lg);
        margin-bottom: var(--space-md);
        background: var(--c-surface);
        padding: var(--space-sm);
        border: 1px solid var(--c-border);
        border-radius: var(--radius-md);
    }

    /* ... shared styles ref ... */
    .input-section {
        margin-bottom: var(--space-lg);
    }
    .h-date-row {
        display: grid;
        grid-template-columns: 1fr 2fr 1.5fr;
        gap: var(--space-sm);
    }
    .form-input,
    .form-select {
        width: 100%;
        padding: var(--space-sm);
        border: 1px solid var(--c-border);
        border-radius: var(--radius-md);
        font-size: 1.1rem;
    }
    .btn-primary {
        width: 100%;
        padding: var(--space-sm);
        background: var(--c-primary);
        color: white;
        border: none;
        border-radius: var(--radius-md);
        font-size: 1.1rem;
        cursor: pointer;
    }
    .hidden {
        display: none;
    }

    .result-container {
        margin-top: var(--space-lg);
        animation: fadeIn 0.4s ease;
    }

    .result-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--space-md);
    }

    @media (max-width: 500px) {
        .result-grid {
            grid-template-columns: 1fr;
        }
    }

    .result-card {
        background: var(--c-surface);
        padding: var(--space-md);
        border-radius: var(--radius-lg);
        border: 1px solid var(--c-border);
        text-align: center;
    }

    .g-aging {
        border-top: 4px solid #3b82f6;
    } /* Blue */
    .h-aging {
        border-top: 4px solid #10b981;
    } /* Green */

    .result-card h3 {
        margin-bottom: var(--space-sm);
        font-size: 1.1rem;
    }

    .main-age .value {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--c-text-main);
    }
    .main-age .unit {
        font-size: 0.9rem;
        color: var(--c-text-muted);
    }

    .small-details {
        margin-top: var(--space-xs);
        font-size: 0.9rem;
        color: var(--c-text-muted);
    }

    .extra-info {
        margin-top: var(--space-md);
        text-align: center;
        padding-top: var(--space-md);
        border-top: 1px solid var(--c-border);
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
