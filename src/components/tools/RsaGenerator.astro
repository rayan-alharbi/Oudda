---

---

<div class="rsa-tool">
    <div class="controls">
        <label>Key Size (bits)</label>
        <select id="size">
            <option value="1024">1024</option>
            <option value="2048" selected>2048</option>
            <option value="4096">4096 (Slow)</option>
        </select>
        <button id="gen-btn" class="btn-primary">Generate Key Pair</button>
    </div>

    <div class="keys">
        <div class="key-box">
            <label>Public Key (PEM)</label>
            <textarea id="pub" readonly></textarea>
            <button class="copy-btn" data-target="pub">Copy Public Key</button>
        </div>
        <div class="key-box">
            <label>Private Key (PEM)</label>
            <textarea id="priv" readonly></textarea>
            <button class="copy-btn" data-target="priv">Copy Private Key</button
            >
        </div>
    </div>

    <div id="status"></div>
</div>

<script>
    const pubEl = document.getElementById("pub") as HTMLTextAreaElement;
    const privEl = document.getElementById("priv") as HTMLTextAreaElement;
    const statusEl = document.getElementById("status");

    function arrayBufferToBase64(buffer) {
        let binary = "";
        const bytes = new Uint8Array(buffer);
        const len = bytes.byteLength;
        for (let i = 0; i < len; i++) {
            binary += String.fromCharCode(bytes[i]);
        }
        return window.btoa(binary);
    }

    function formatPem(key, type) {
        const b64 = arrayBufferToBase64(key);
        const label = type === "public" ? "PUBLIC KEY" : "PRIVATE KEY";
        let pem = `-----BEGIN ${label}-----\n`;
        for (let i = 0; i < b64.length; i += 64) {
            pem += b64.substring(i, i + 64) + "\n";
        }
        pem += `-----END ${label}-----`;
        return pem;
    }

    document.getElementById("gen-btn").addEventListener("click", async () => {
        statusEl.textContent = "Generating... Please wait.";
        pubEl.value = "";
        privEl.value = "";

        const size = parseInt(
            (document.getElementById("size") as HTMLSelectElement).value,
        );

        try {
            const keyPair = await window.crypto.subtle.generateKey(
                {
                    name: "RSA-OAEP",
                    modulusLength: size,
                    publicExponent: new Uint8Array([1, 0, 1]),
                    hash: "SHA-256",
                },
                true,
                ["encrypt", "decrypt"],
            );

            const exportedPub = await window.crypto.subtle.exportKey(
                "spki",
                keyPair.publicKey,
            );
            const exportedPriv = await window.crypto.subtle.exportKey(
                "pkcs8",
                keyPair.privateKey,
            );

            pubEl.value = formatPem(exportedPub, "public");
            privEl.value = formatPem(exportedPriv, "private");
            statusEl.textContent = "Done!";
        } catch (e) {
            statusEl.textContent = "Error: " + e.message;
        }
    });

    document.querySelectorAll(".copy-btn").forEach((btn) => {
        btn.addEventListener("click", (e) => {
            const temp = e.target as HTMLElement;
            const targetId = temp.getAttribute("data-target");
            const el = document.getElementById(targetId) as HTMLTextAreaElement;
            el.select();
            document.execCommand("copy");
            const original = temp.textContent;
            temp.textContent = "Copied!";
            setTimeout(() => (temp.textContent = original), 2000);
        });
    });
</script>

<style>
    .rsa-tool {
        display: flex;
        flex-direction: column;
        gap: 2rem;
        max-width: 800px;
        margin: 0 auto;
    }
    .controls {
        display: flex;
        gap: 1rem;
        align-items: center;
        justify-content: center;
    }
    select {
        padding: 1rem;
        border: 1px solid var(--c-border);
        border-radius: 6px;
    }
    .btn-primary {
        padding: 1rem 2rem;
        background: var(--c-primary);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
    }
    .keys {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }
    @media (max-width: 768px) {
        .keys {
            grid-template-columns: 1fr;
        }
    }
    .key-box {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    textarea {
        height: 300px;
        padding: 1rem;
        border: 1px solid var(--c-border);
        border-radius: 8px;
        font-family: monospace;
        font-size: 0.8rem;
    }
    .copy-btn {
        padding: 0.5rem;
        background: var(--c-surface-alt);
        border: 1px solid var(--c-border);
        cursor: pointer;
        border-radius: 4px;
    }
    #status {
        text-align: center;
        font-weight: bold;
        color: var(--c-primary);
    }
</style>
